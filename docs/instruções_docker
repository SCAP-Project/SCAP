# Instruções para Gerenciamento do Ambiente Docker - TCC Financial DW

## Iniciando o Projeto (Primeira vez ou após ligar o PC)
Certifique-se de que o Docker Desktop está rodando.
Navegue até a pasta do projeto (d:\Faculdade\TCC) e execute:

```
docker-compose up -d
```

Isso inicia o container PostgreSQL em background. Aguarde alguns segundos para a inicialização completa.

## Verificando se Está Funcionando
Para ver o status dos containers:
```
docker-compose ps
```
Deve mostrar o container "tcc-postgres-dw" como "Up" e saudável.

Para ver os logs (útil para verificar se os scripts SQL rodaram):
```
docker-compose logs postgres-dw
```

## Conectando ao Banco de Dados
Para conectar via linha de comando:
```
docker-compose exec postgres-dw psql -U nbeserra -d financial_dw
```
Senha: App456!

Para ver as tabelas criadas:
```
\dt raw.*
\dn
```

## Parando o Projeto
Quando não precisar mais:
```
docker-compose down
```
Isso para o container mas mantém os dados.

## Reiniciando (Sem Perder Dados)
Se precisar reiniciar sem recriar tudo:
```
docker-compose restart
```

## Recriando Tudo do Zero (Apagar Dados)
Cuidado: Isso apaga TODOS os dados do banco!
1. Pare o container:
   ```
   docker-compose down
   ```
2. Remova os dados persistentes:
   ```
   Remove-Item -Recurse -Force .\docker\postgres\data\*
   ```
3. Reinicie:
   ```
   docker-compose up -d
   ```
   Os scripts SQL serão executados novamente, recriando schemas e tabelas.

## Solução de Problemas
- Se o container não sobe: Verifique se a porta 5432 está livre (netstat -ano | findstr :5432).
- Se scripts não rodaram: Verifique logs e certifique-se de que o diretório data estava vazio.
- Para limpar tudo (containers, redes, volumes não usados):
  ```
  docker-compose down -v --remove-orphans
  docker system prune
  ```

## Estrutura do Projeto
- **docker/postgres/data**: Dados do PostgreSQL (não versionar).
- **sql/ddl**: Scripts de criação do banco.
- **data**: Dados brutos para ingestão.
- **docker-compose.yml**: Configuração dos containers.

Sempre execute comandos no PowerShell dentro da pasta do projeto.